generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This table contains exclusion constraints and requires additional setup for migrations. Visit https://pris.ly/d/exclusion-constraints for more info.
model bookings {
  booking_id  String         @id @default(uuid()) @db.Uuid
  player_id   String?        @db.Uuid
  field_id    String         @db.Uuid
  start_time  DateTime       @db.Timestamptz(6)
  end_time    DateTime       @db.Timestamptz(6)
  total_price Decimal        @db.Decimal(10, 2)
  status      booking_status @default(pending)
  guest_name  String?        @db.VarChar(255)
  guest_phone String?        @db.VarChar(50)
  created_at  DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?      @default(now()) @db.Timestamptz(6)
  fields      fields         @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)
  users       users?         @relation(fields: [player_id], references: [user_id], onDelete: SetNull, onUpdate: NoAction)
  payments    payments[]

  @@index([field_id], map: "idx_bookings_field_id")
  @@index([player_id], map: "idx_bookings_player_id")
}

model field_photos {
  photo_id   String    @id @default(uuid()) @db.Uuid
  field_id   String    @db.Uuid
  image_url  String    @db.VarChar(1024)
  is_cover   Boolean?  @default(false)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  fields     fields    @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)
}

model fields {
  field_id            String                    @id @default(uuid()) @db.Uuid
  owner_id            String                    @db.Uuid
  name                String                    @db.VarChar(255)
  address             String
  description         String?
  location            Unsupported("geography")?
  amenities           Json?                     @default("{}")
  base_price_per_hour Decimal                   @db.Decimal(10, 2)
  created_at          DateTime?                 @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?                 @default(now()) @db.Timestamptz(6)
  deleted_at          DateTime?                 @db.Timestamptz(6)
  bookings            bookings[]
  field_photos        field_photos[]
  users               users                     @relation(fields: [owner_id], references: [user_id], onUpdate: NoAction)
  reviews             reviews[]
  promotions          promotions[]
  products            products[]
  schedule_blocks     schedule_blocks[]

  @@index([location], map: "idx_fields_location", type: Gist)
  @@index([owner_id], map: "idx_fields_owner_id")
}

model promotions {
  promotion_id   String        @id @default(uuid()) @db.Uuid
  field_id       String        @db.Uuid
  title          String        @db.VarChar(255)
  description    String?
  discount_type  discount_type
  discount_value Decimal       @db.Decimal(10, 2)
  start_date     DateTime      @db.Timestamptz(6)
  end_date       DateTime      @db.Timestamptz(6)
  is_active      Boolean       @default(true)
  created_at     DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?     @default(now()) @db.Timestamptz(6)
  deleted_at     DateTime?     @db.Timestamptz(6)
  fields         fields        @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([field_id], map: "idx_promotions_field_id")
}

model products {
  product_id  String           @id @default(uuid()) @db.Uuid
  field_id    String           @db.Uuid
  name        String           @db.VarChar(255)
  description String?
  price       Decimal          @db.Decimal(10, 2)
  image_url   String?          @db.VarChar(1024)
  category    product_category
  is_active   Boolean          @default(true)
  created_at  DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?        @default(now()) @db.Timestamptz(6)
  deleted_at  DateTime?        @db.Timestamptz(6)
  fields      fields           @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([field_id], map: "idx_products_field_id")
}

model schedule_blocks {
  block_id   String             @id @default(uuid()) @db.Uuid
  field_id   String             @db.Uuid
  start_time DateTime           @db.Timestamptz(6)
  end_time   DateTime           @db.Timestamptz(6)
  reason     schedule_block_reason
  note       String?
  created_at DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at DateTime?          @default(now()) @db.Timestamptz(6)
  fields     fields             @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([field_id], map: "idx_schedule_blocks_field_id")
  @@index([start_time, end_time], map: "idx_schedule_blocks_time_range")
}

model staff_members {
  staff_id    String      @id @default(uuid()) @db.Uuid
  manager_id  String      @db.Uuid
  name        String      @db.VarChar(255)
  email       String      @db.VarChar(255)
  phone       String?     @db.VarChar(50)
  role        staff_role  @default(encargado)
  permissions Json?       @default("{}")
  is_active   Boolean     @default(true)
  created_at  DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?   @default(now()) @db.Timestamptz(6)
  deleted_at  DateTime?   @db.Timestamptz(6)
  manager     users       @relation(fields: [manager_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([manager_id], map: "idx_staff_members_manager_id")
}

model payment_settings {
  setting_id          String               @id @default(uuid()) @db.Uuid
  manager_id          String               @unique @db.Uuid
  yape_enabled        Boolean              @default(false)
  yape_phone          String?              @db.VarChar(50)
  plin_enabled        Boolean              @default(false)
  plin_phone          String?              @db.VarChar(50)
  bank_transfer_enabled Boolean            @default(false)
  bank_name           String?              @db.VarChar(100)
  bank_account_number String?              @db.VarChar(50)
  bank_account_holder String?              @db.VarChar(255)
  bank_cci            String?              @db.VarChar(50)
  cash_enabled        Boolean              @default(true)
  created_at          DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?            @default(now()) @db.Timestamptz(6)
  manager             users                @relation(fields: [manager_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([manager_id], map: "idx_payment_settings_manager_id")
}

model payments {
  payment_id         String         @id @default(uuid()) @db.Uuid
  booking_id         String         @db.Uuid
  amount             Decimal        @db.Decimal(10, 2)
  status             payment_status @default(pending)
  payment_gateway_id String?        @db.VarChar(255)
  created_at         DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?      @default(now()) @db.Timestamptz(6)
  bookings           bookings       @relation(fields: [booking_id], references: [booking_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([booking_id], map: "idx_payments_booking_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  review_id  String    @id @default(uuid()) @db.Uuid
  field_id   String    @db.Uuid
  player_id  String?   @db.Uuid
  rating     Int       @db.SmallInt
  comment    String?
  tags       String[]  @default([])
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  fields     fields    @relation(fields: [field_id], references: [field_id], onDelete: Cascade, onUpdate: NoAction)
  users      users?    @relation(fields: [player_id], references: [user_id], onUpdate: NoAction)

  @@unique([field_id, player_id])
  @@index([field_id], map: "idx_reviews_field_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model spatial_ref_sys {
  srid      Int     @id
  auth_name String? @db.VarChar(256)
  auth_srid Int?
  srtext    String? @db.VarChar(2048)
  proj4text String? @db.VarChar(2048)
}

model users {
  user_id          String             @id @default(uuid()) @db.Uuid
  email            String             @unique @db.VarChar(255)
  password_hash    String?            @db.VarChar(255)
  phone_number     String?            @db.VarChar(50)
  role             user_role          @default(player)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  auth_provider    auth_provider_type @default(email)
  auth_provider_id String?            @db.VarChar(255)
  city             String?            @db.VarChar(100)
  district         String?            @db.VarChar(100)
  document_number  String?            @db.VarChar(20)
  document_type    String?            @db.VarChar(20)
  first_name       String             @db.VarChar(100)
  last_name        String             @db.VarChar(100)
  bookings         bookings[]
  fields           fields[]
  reviews          reviews[]
  business_profile business_profiles?
  staff_members    staff_members[]
  payment_settings payment_settings?

  @@index([email], map: "idx_users_email")
}

model business_profiles {
  profile_id    String    @id @default(uuid()) @db.Uuid
  user_id       String    @unique @db.Uuid
  business_name String    @db.VarChar(255)
  ruc           String    @unique @db.VarChar(20)
  address       String?   @db.VarChar(500)
  phone         String?   @db.VarChar(50)
  email         String?   @db.VarChar(255)
  settings      Json?     @default("{}")
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  updated_at    DateTime? @default(now()) @db.Timestamptz(6)
  users         users     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_business_profiles_user_id")
}

enum booking_status {
  pending
  confirmed
  cancelled
}

enum payment_status {
  pending
  succeeded
  failed
}

enum user_role {
  player
  manager
}

enum auth_provider_type {
  email
  google
  facebook
  apple
}

enum discount_type {
  percentage
  fixed_amount
}

enum product_category {
  bebida
  snack
  equipo
  promocion
}

enum schedule_block_reason {
  maintenance
  personal
  event
}

enum staff_role {
  encargado
  administrador
  recepcionista
  mantenimiento
}
